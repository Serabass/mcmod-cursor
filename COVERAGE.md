# 📊 Измерение покрытия кода тестами

## 🚀 Быстрый старт

### PowerShell скрипт (рекомендуется)
```powershell
.\run-tests-with-coverage.ps1
```

Скрипт автоматически:
1. Очистит старые результаты
2. Запустит тесты
3. Сгенерирует отчёты о покрытии
4. Откроет HTML отчёты в браузере

### Ручной запуск

#### 1. Запустить тесты с покрытием
```powershell
./gradlew test jacocoTestReport
```

#### 2. Открыть отчёт о покрытии
```powershell
start build\reports\jacoco\test\html\index.html
```

#### 3. Открыть отчёт о тестах
```powershell
start build\reports\tests\test\index.html
```

## 📁 Где находятся отчёты

### HTML отчёты (для просмотра)
- **Покрытие кода:** `build/reports/jacoco/test/html/index.html`
- **Результаты тестов:** `build/reports/tests/test/index.html`

### Другие форматы
- **XML:** `build/reports/jacoco/test/jacocoTestReport.xml` (для CI/CD)
- **CSV:** `build/reports/jacoco/test/jacocoTestReport.csv` (для анализа)

## 📊 Что показывает отчёт о покрытии

### Метрики JaCoCo:

1. **Instructions** - покрытие байт-кода
2. **Branches** - покрытие веток (if/else, switch)
3. **Lines** - покрытие строк кода
4. **Methods** - покрытие методов
5. **Classes** - покрытие классов

### Цветовая схема:

- 🟢 **Зелёный** - выполнялся в тестах
- 🟡 **Жёлтый** - частично выполнялся
- 🔴 **Красный** - не выполнялся

## 🎯 Целевые показатели

### Для Cursor Mod:
```
📦 Блоки (PigSpawnerBlock):         > 80%
⚙️  BlockEntity:                     > 70%
🐷 Сущности (ExplodingPig):         > 60%
🧪 Общее покрытие:                  > 30%
```

### Текущие результаты:
```
🏗️ Структура тестов:    100% ✅
📝 Тесты написаны:       31 тест ✅
🎮 Игровое тесто:       100% ✅
⚠️  Моки ограничены:    Java 23
```

## 🔧 Дополнительные команды

### Проверить минимальное покрытие
```powershell
./gradlew jacocoTestCoverageVerification
```

### Только отчёт (без запуска тестов)
```powershell
./gradlew jacocoTestReport
```

### Очистить и запустить заново
```powershell
./gradlew clean test jacocoTestReport
```

## 📈 Интерпретация результатов

### Высокое покрытие (>80%)
```
🟢 Код хорошо протестирован
✅ Изменения безопасны
💪 Баги маловероятны
```

### Среднее покрытие (50-80%)
```
🟡 Основная логика покрыта
⚠️  Есть непротестированные пути
🔍 Нужны дополнительные тесты
```

### Низкое покрытие (<50%)
```
🔴 Много непротестированного кода
⚡ Высокий риск багов
🧪 Требуются тесты!
```

## 🎨 Пример отчёта

В HTML отчёте вы увидите:

```
com.cursormod
├── block
│   ├── PigSpawnerBlock          85% 🟢
│   └── entity
│       └── PigSpawnerBlockEntity 72% 🟡
├── entity
│   └── ExplodingPig             45% 🟡
├── item
│   └── [другие классы]          0% 🔴
└── ...
```

## 🚧 Известные ограничения

### Что не измеряется:
- ❌ Моки Minecraft (проблема с Java 23)
- ❌ Клиентский код (ClientModInitializer)
- ❌ Миксины (исключены намеренно)
- ❌ Генераторы данных

### Что измеряется хорошо:
- ✅ Логика блоков
- ✅ BlockEntity методы
- ✅ Публичные API
- ✅ Утилитные классы

## 💡 Советы

### 1. Фокус на важном коде
Не гонитесь за 100% - важнее покрыть:
- Критическую бизнес-логику
- Сложные алгоритмы
- Edge cases

### 2. Используйте отчёт для поиска проблем
Красные участки = потенциальные баги!

### 3. Регулярно запускайте
```powershell
# Перед коммитом
.\run-tests-with-coverage.ps1

# При рефакторинге
./gradlew test jacocoTestReport
```

## 🎓 Обучающие ресурсы

### JaCoCo документация:
- https://www.jacoco.org/jacoco/trunk/doc/

### Gradle JaCoCo плагин:
- https://docs.gradle.org/current/userguide/jacoco_plugin.html

## 🎉 Заключение

**Измерение покрытия помогает:**
- 📊 Визуализировать качество тестов
- 🎯 Найти непротестированный код
- 💪 Повысить уверенность в изменениях
- 🐛 Предотвратить баги

**Даже хаос нужно измерять!** 🐷💣📊

---

*"Если не можешь измерить - не можешь улучшить!"*

